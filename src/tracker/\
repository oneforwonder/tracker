(ns tracker.models.database
  (:require [datomic.api :only [db q] :as d]))

(def base-schema
  [{:db/doc         "A generic name attribute."
    :db/ident       :gen/name
    :db/id          #db/id[:db.part/db]
    :db/valueType   :db.type/string
    :db/cardinality :db.cardinality/one
    :db.install/attribute :db.part/db}

   {:db/doc         "A generic ID attribute."
    :db/ident       :gen/id 
    :db/id          #db/id[:db.part/db]
    :db/valueType   :db.type/uuid
    :db/cardinality :db.cardinality/one
    :db.install/attribute :db.part/db}])

(defn init-db []
  (let [uri   "datomic:free://localhost:4334/tracker"
        dbase (d/create-database uri)
        conn  (d/connect uri)]
    (d/transact conn base-schema)
    conn))

(defn add-attribute [dbase ident vt crd & optional]
  (d/transact dbase 
    [{:db/id                (d/tempid :db.part/db)
      :db.install/attribute :db.part/db 
      :db/ident             (keyword ident)
      :db/valueType         (keyword (str "db.valueType/" vt))
      :db/cardinality       (keyword (str "db.cardinality/" crd))
      
     }]
              )
  )
